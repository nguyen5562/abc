﻿@using X.PagedList
@using X.PagedList.Mvc.Core;
@using ShopPet.Extensions;
@inject CheckRole CheckRoleInstance
@{
    ViewData["Title"] = "Index";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
    IPagedList<HoaDon> dsfull = ViewBag.PagedList;
    IPagedList<HoaDon> ds1 = ViewBag.PagedList1;
    IPagedList<HoaDon> ds2 = ViewBag.PagedList2;
    IPagedList<HoaDon> ds3 = ViewBag.PagedList3;
    IPagedList<HoaDon> ds4 = ViewBag.PagedList4;
    string username = User.Identity.Name;
}

@if (await CheckRoleInstance.CheckViewOrderByUser(username))
{
    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <!-- Main content -->
        <div class="container-fluid">
            <div class="row row--top-40">
                <div class="col-md-12">
                    <h2 class="row__title">Danh sách hóa đơn (@ViewBag.TotalItemCount)</h2>
                </div>
            </div>

            <!-- Tìm kiếm -->
            <form asp-action="Index" method="get" id="formSearch">
                <div class="col-md-9">
                    <div class="input-group" style="margin-left:-22px">
                        <div style="padding: .25rem 1rem">
                            <label>Email:</label>
                            <input type="text" name="email" value="@ViewBag.email" class="form-control">
                        </div>

                        <div style="padding: .25rem 1rem">
                            <label>Địa chỉ:</label>
                            <input type="text" name="diachi" value="@ViewBag.diachi" class="form-control">
                        </div>

                        <div style="padding: .25rem 1rem">
                            <label>Số điện thoại:</label>
                            <input type="text" name="sdt" value="@ViewBag.sdt" class="form-control">
                        </div>

                        <div style="padding: .25rem 1rem">
                            <label>Từ ngày:</label>
                            <input type="date" id="beginDate" name="beginDate" value="@(((DateTime)ViewBag.beginDate).ToString("yyyy-MM-dd"))" class="form-control">
                        </div>

                        <div style="padding: .25rem 1rem">
                            <label>Đến ngày:</label>
                            <input type="date" id="endDate" name="endDate" value="@(((DateTime)ViewBag.endDate).ToString("yyyy-MM-dd"))" class="form-control">
                        </div>

                        <div style="padding: .25rem 1rem; margin-top: 32px">
                            <input type="submit" value="Tìm kiếm" class="btn btn-primary">
                        </div>

                        <div style="padding: .25rem 1rem; margin-top: 32px">
                            <a href="~/Admin/Order" class="btn btn-secondary">Khôi phục</a>
                        </div>

                        <input type="hidden" name="pageId" id="pageId" value="">
                    </div>
                </div>
            </form>

            <div class="container-fluid">
                <div class="row row--top-20">
                    <div class="col-md-12">
                        <div class="tabs-wrapper">
                            <ul id="scroller" class="nav nav-tabs">
                                <li class="@(1 == ViewBag.PageId ? "active" : "")" style="min-width: 143px;"><a data-toggle="tab" href="#menu1">Chờ xác nhận (@ViewBag.TotalItemCount1)</a></li>
                                <li class="@(2 == ViewBag.PageId ? "active" : "")" style="min-width: 143px;"><a data-toggle="tab" href="#menu2">Đang giao hàng (@ViewBag.TotalItemCount2)</a></li>
                                <li class="@(3 == ViewBag.PageId ? "active" : "")" style="min-width: 143px;"><a data-toggle="tab" href="#menu3">Đã giao hàng (@ViewBag.TotalItemCount3)</a></li>
                                <li class="@(4 == ViewBag.PageId ? "active" : "")" style="min-width: 143px;"><a data-toggle="tab" href="#menu4">Đã hủy (@ViewBag.TotalItemCount4)</a></li>
                            </ul>
                        </div>
                        <div class="tab-content">
                            <div id="menu1" class="tab-pane fade @(1 == ViewBag.PageId ? "active show" : "")">
                                <table id="showtable1" class="table">
                                    <thead class="table__thead">
                                        <tr>
                                            <th class="table__th">Email</th>
                                            <th class="table__th">Ngày tạo</th>
                                            <th class="table__th">Địa chỉ</th>
                                            <th class="table__th">SĐT</th>
                                            <th class="table__th">Ghi chú</th>
                                            <th class="table__th">Thanh toán</th>
                                            <th class="table__th">Trạng thái</th>
                                            <th class="table__th"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var items in ds1)
                                        {
                                            <tr class="table-row table-row--chris">
                                                <td class="table-row__td">
                                                    <p>@items.UserName</p>
                                                </td>
                                                <td class="table-row__td">
                                                    <p>@items.NgayTao</p>
                                                </td>
                                                <td class="table-row__td">
                                                    <p>@items.DiaChi</p>
                                                </td>
                                                <td class="table-row__td">
                                                    <p>@items.SĐT</p>
                                                </td>
                                                <td class="table-row__td">
                                                    <p>@items.Note</p>
                                                </td>
                                                <td class="table-row__td">
                                                    @if (items.ThanhToan == 0)
                                                    {
                                                        <p>Thanh toán khi nhận hàng</p>
                                                    }
                                                    @if (items.ThanhToan == 1)
                                                    {
                                                        <p>Thanh toán qua paypal</p>
                                                    }
                                                </td>
                                                <td class="table-row__td">
                                                    @if (items.TrangThai == 1)
                                                    {
                                                        <p>Chờ xác nhận</p>
                                                    }
                                                </td>
                                                <td class="table-row__td">
                                                    <div class="input-form">

                                                        @if (await CheckRoleInstance.CheckEditOrderByUser(username))
                                                        {
                                                            <a href="@Url.Action("Xacnhan", "Order", new { @id = items.MaHD, page1 = ViewBag.Page1 })" class="btn btn-primary">Xác nhận</a>
                                                            <a href="@Url.Action("Huy", "Order", new { @id = items.MaHD, page1 = ViewBag.Page1, pageId = 1 })" class="btn btn-danger">Hủy</a>
                                                        }

                                                        <a class="btn btn-info" data-toggle="modal" id="viewbtn1" data-target="#showmodal1" data-orderid="@items.MaHD">Chi tiết</a>
                                                    </div>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                                <div class="col-sm-12 " style="display:flex;justify-content: space-between;">
                                   
                                    <div class="dataTables_paginate paging_simple_numbers" id="example1_paginate">
                                        <ul class="pagination">
                                            @if (ds1.HasPreviousPage)
                                            {
                                                <li class="page-item">
                                                    <a class="page-link" href="@Url.Action("Index", "Order", new { page1 = ds1.PageNumber - 1, pageId = 1 })"><i class="fa fa-angle-left"></i></a>
                                                </li>

                                            }

                                            <li class="page-item @(1 == ViewBag.Page1 ? "active" : "")">
                                                <a class="page-link" href="@Url.Action("Index", "Order", new { page1 = 1, pageId = 1 })">1</a>
                                            </li>

                                            @if (ds1.PageNumber > 3)
                                            {
                                                <li class="page-item">
                                                    <span class="page-link">...</span>
                                                </li>
                                            }

                                            @for (int i = ds1.PageNumber - 1; i <= ds1.PageNumber + 1; i++)
                                            {
                                                if (i > 1 && i < ds1.PageCount)
                                                {
                                                    <li class="page-item @(i == ds1.PageNumber ? "active" : "")">
                                                        <a class="page-link" href="@Url.Action("Index", "Order", new { page1 = i, pageId = 1 })">@i</a>
                                                    </li>
                                                }
                                            }

                                            @if (ds1.PageNumber < ds1.PageCount - 2)
                                            {
                                                <li class="page-item">
                                                    <span class="page-link">...</span>
                                                </li>
                                            }

                                            @if (ds1.PageCount > 1)
                                            {
                                                <li class="page-item @(ds1.PageCount == ViewBag.Page1 ? "active" : "") ">
                                                    <a class="page-link" href="@Url.Action("Index", "Order", new { page1 = ds1.PageCount, pageId = 1 })">@ds1.PageCount</a>
                                                </li>
                                            }

                                            @if (ds1.HasNextPage)
                                            {

                                                <li class="page-item">
                                                    <a class="page-link" href="@Url.Action("Index", "Order", new { page1 = ds1.PageNumber + 1, pageId = 1 })"><i class="fa fa-angle-right"></i></a>
                                                </li>
                                            }
                                        </ul>
                                       
                                    </div>
                                    <p>Danh sách từ @ViewBag.PageStartItem1 đến @ViewBag.PageEndItem1 trên tổng số @ViewBag.TotalItemCount1 hóa đơn chưa xác nhận</p>
                                </div>
                                <div class="modal fade" id="showmodal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered modal-xl" role="document" style="max-width: 700px;">
                                        <!-- Content will be loaded here dynamically -->
                                    </div>
                                </div>
                                <script>
                                    // Wait for the document to be ready
                                    $(document).ready(function () {
                                        // Attach click event to the button with id "viewbtn" inside the element with id "showtable"
                                        $("#showtable1").on("click", "#viewbtn1", function () {
                                            // Get the order ID from the data-orderid attribute of the clicked button
                                            var id = $(this).data('orderid');

                                            // Make an AJAX request to the server to fetch the details for the given order ID
                                            $.ajax({
                                                url: "@Url.Action("Details", "Order")",
                                                data: { id: id },
                                                type: 'GET',
                                                success: function (data) {
                                                    // Replace the content of the modal with the received data
                                                    $("#showmodal1 .modal-dialog").html(data);
                                                },
                                                error: function (error) {
                                                    // Log any errors to the console
                                                    console.error("Error fetching details:", error);
                                                }
                                            });
                                        });
                                    });
                                </script>
                            </div>
                            <div id="menu2" class="tab-pane fade @(2 == ViewBag.PageId ? "active show" : "")">
                                <table id="showtable2" class="table">
                                    <thead class="table__thead">
                                        <tr>
                                            <th class="table__th">Email</th>
                                            <th class="table__th">Ngày tạo</th>
                                            <th class="table__th">Địa chỉ</th>
                                            <th class="table__th">SĐT</th>
                                            <th class="table__th">Ghi chú</th>
                                            <th class="table__th">Thanh toán</th>
                                            <th class="table__th">Trạng thái</th>
                                            <th class="table__th"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var items in ds2)
                                        {
                                            <tr class="table-row table-row--chris">
                                                <td class="table-row__td">
                                                    <p>@items.UserName</p>
                                                </td>
                                                <td class="table-row__td">
                                                    <p>@items.NgayTao</p>
                                                </td>
                                                <td class="table-row__td">
                                                    <p>@items.DiaChi</p>
                                                </td>
                                                <td class="table-row__td">
                                                    <p>@items.SĐT</p>
                                                </td>
                                                <td class="table-row__td">
                                                    <p>@items.Note</p>
                                                </td>
                                                <td class="table-row__td">
                                                    @if (items.ThanhToan == 0)
                                                    {
                                                        <p>Thanh toán khi nhận hàng</p>
                                                    }
                                                    @if (items.ThanhToan == 1)
                                                    {
                                                        <p>Thanh toán qua paypal</p>
                                                    }
                                                </td>
                                                <td class="table-row__td">
                                                    @if (items.TrangThai == 2)
                                                    {
                                                        <p>Đang giao hàng</p>
                                                    }
                                                </td>
                                                <td class="table-row__td">
                                                    <div class="input-form">

                                                        @if (await CheckRoleInstance.CheckEditOrderByUser(username))
                                                        {
                                                            <a href="@Url.Action("Vanchuyen", "Order", new { @id = items.MaHD, page2 = ViewBag.Page2 })" class="btn btn-primary">Vận chuyển</a>
                                                            <a href="@Url.Action("Huy", "Order", new { @id = items.MaHD, page2 = ViewBag.Page2, pageId = 2 })" class="btn btn-danger">Hủy</a>
                                                        }

                                                        <a class="btn btn-info" data-toggle="modal" id="viewbtn2" data-target="#showmodal2" data-orderid="@items.MaHD">Chi tiết</a>
                                                    </div>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                                <div class="col-sm-12 col-md-7">
                                    <p>Danh sách từ @ViewBag.PageStartItem2 đến @ViewBag.PageEndItem2 trên tổng số @ViewBag.TotalItemCount2 hóa đơn đang giao hàng</p>
                                    <div class="dataTables_paginate paging_simple_numbers" id="example1_paginate">
                                        <ul class="pagination">
                                            @if (ds2.HasPreviousPage)
                                            {
                                                <li class="page-item">
                                                    <a class="page-link" href="@Url.Action("Index", "Order", new { page2 = ds2.PageNumber - 1, pageId = 2 })"><i class="fa fa-angle-left"></i></a>
                                                </li>

                                            }

                                            <li class="page-item @(1 == ViewBag.Page2 ? "active" : "")">
                                                <a class="page-link" href="@Url.Action("Index", "Order", new { page2 = 1, pageId = 2 })">1</a>
                                            </li>

                                            @if (ds2.PageNumber > 3)
                                            {
                                                <li class="page-item">
                                                    <span class="page-link">...</span>
                                                </li>
                                            }

                                            @for (int i = ds2.PageNumber - 1; i <= ds2.PageNumber + 1; i++)
                                            {
                                                if (i > 1 && i < ds2.PageCount)
                                                {
                                                    <li class="page-item @(i == ds2.PageNumber ? "active" : "")">
                                                        <a class="page-link" href="@Url.Action("Index", "Order", new { page2 = i, pageId = 2 })">@i</a>
                                                    </li>
                                                }
                                            }

                                            @if (ds2.PageNumber < ds2.PageCount - 2)
                                            {
                                                <li class="page-item">
                                                    <span class="page-link">...</span>
                                                </li>
                                            }

                                            @if (ds2.PageCount > 1)
                                            {
                                                <li class="page-item @(ds2.PageCount == ViewBag.Page2 ? "active" : "") ">
                                                    <a class="page-link" href="@Url.Action("Index", "Order", new { page2 = ds2.PageCount, pageId = 2 })">@ds2.PageCount</a>
                                                </li>
                                            }

                                            @if (ds2.HasNextPage)
                                            {

                                                <li class="page-item">
                                                    <a class="page-link" href="@Url.Action("Index", "Order", new { page2 = ds2.PageNumber + 1, pageId = 2 })"><i class="fa fa-angle-right"></i></a>
                                                </li>
                                            }
                                        </ul>
                                    </div>
                                </div>
                                <div class="modal fade" id="showmodal2" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered modal-xl" role="document" style="max-width: 700px;">
                                        <!-- Content will be loaded here dynamically -->
                                    </div>
                                </div>
                                <script>
                                    // Wait for the document to be ready
                                    $(document).ready(function () {
                                        // Attach click event to the button with id "viewbtn" inside the element with id "showtable"
                                        $("#showtable2").on("click", "#viewbtn2", function () {
                                            // Get the order ID from the data-orderid attribute of the clicked button
                                            var id = $(this).data('orderid');

                                            // Make an AJAX request to the server to fetch the details for the given order ID
                                            $.ajax({
                                                url: "@Url.Action("Details", "Order")",
                                                data: { id: id },
                                                type: 'GET',
                                                success: function (data) {
                                                    // Replace the content of the modal with the received data
                                                    $("#showmodal2 .modal-dialog").html(data);
                                                },
                                                error: function (error) {
                                                    // Log any errors to the console
                                                    console.error("Error fetching details:", error);
                                                }
                                            });
                                        });
                                    });
                                </script>
                            </div>
                            <div id="menu3" class="tab-pane fade @(3 == ViewBag.PageId ? "active show" : "")">
                                <table id="showtable3" class="table">
                                    <thead class="table__thead">
                                        <tr>
                                            <th class="table__th">Email</th>
                                            <th class="table__th">Ngày tạo</th>
                                            <th class="table__th">Địa chỉ</th>
                                            <th class="table__th">SĐT</th>
                                            <th class="table__th">Ghi chú</th>
                                            <th class="table__th">Thanh toán</th>
                                            <th class="table__th">Trạng thái</th>
                                            <th class="table__th"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var items in ds3)
                                        {
                                            <tr class="table-row table-row--chris">
                                                <td class="table-row__td">
                                                    <p>@items.UserName</p>
                                                </td>
                                                <td class="table-row__td">
                                                    <p>@items.NgayTao</p>
                                                </td>
                                                <td class="table-row__td">
                                                    <p>@items.DiaChi</p>
                                                </td>
                                                <td class="table-row__td">
                                                    <p>@items.SĐT</p>
                                                </td>
                                                <td class="table-row__td">
                                                    <p>@items.Note</p>
                                                </td>
                                                <td class="table-row__td">
                                                    @if (items.ThanhToan == 0)
                                                    {
                                                        <p>Thanh toán khi nhận hàng</p>
                                                    }
                                                    @if (items.ThanhToan == 1)
                                                    {
                                                        <p>Thanh toán qua paypal</p>
                                                    }
                                                </td>
                                                <td class="table-row__td">
                                                    @if (items.TrangThai == 3)
                                                    {
                                                        <p>Đã giao hàng</p>
                                                    }
                                                </td>
                                                <td class="table-row__td">
                                                    <div class="input-group">
                                                        <a class="btn btn-info" data-toggle="modal" id="viewbtn3" data-target="#showmodal3" data-orderid="@items.MaHD">Chi tiết</a>
                                                    </div>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                                <div class="col-sm-12 col-md-7">
                                    <p>Danh sách từ @ViewBag.PageStartItem3 đến @ViewBag.PageEndItem3 trên tổng số @ViewBag.TotalItemCount3 hóa đơn đã giao hàng</p>
                                    <div class="dataTables_paginate paging_simple_numbers" id="example1_paginate">
                                        <ul class="pagination">
                                            @if (ds3.HasPreviousPage)
                                            {
                                                <li class="page-item">
                                                    <a class="page-link" href="@Url.Action("Index", "Order", new { page3 = ds3.PageNumber - 1, pageId = 3 })"><i class="fa fa-angle-left"></i></a>
                                                </li>

                                            }

                                            <li class="page-item @(1 == ViewBag.Page3 ? "active" : "")">
                                                <a class="page-link" href="@Url.Action("Index", "Order", new { page3 = 1, pageId = 3 })">1</a>
                                            </li>

                                            @if (ds3.PageNumber > 3)
                                            {
                                                <li class="page-item">
                                                    <span class="page-link">...</span>
                                                </li>
                                            }

                                            @for (int i = ds3.PageNumber - 1; i <= ds3.PageNumber + 1; i++)
                                            {
                                                if (i > 1 && i < ds3.PageCount)
                                                {
                                                    <li class="page-item @(i == ds3.PageNumber ? "active" : "")">
                                                        <a class="page-link" href="@Url.Action("Index", "Order", new { page3 = i, pageId = 3 })">@i</a>
                                                    </li>
                                                }
                                            }

                                            @if (ds3.PageNumber < ds3.PageCount - 2)
                                            {
                                                <li class="page-item">
                                                    <span class="page-link">...</span>
                                                </li>
                                            }

                                            @if (ds3.PageCount > 1)
                                            {
                                                <li class="page-item @(ds3.PageCount == ViewBag.Page3 ? "active" : "") ">
                                                    <a class="page-link" href="@Url.Action("Index", "Order", new { page3 = ds3.PageCount, pageId = 3 })">@ds3.PageCount</a>
                                                </li>
                                            }

                                            @if (ds3.HasNextPage)
                                            {

                                                <li class="page-item">
                                                    <a class="page-link" href="@Url.Action("Index", "Order", new { page3 = ds3.PageNumber + 1, pageId = 3 })"><i class="fa fa-angle-right"></i></a>
                                                </li>
                                            }
                                        </ul>
                                    </div>
                                </div>
                                <div class="modal fade" id="showmodal3" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered modal-xl" role="document" style="max-width: 700px;">
                                        <!-- Content will be loaded here dynamically -->
                                    </div>
                                </div>
                                <script>
                                    // Wait for the document to be ready
                                    $(document).ready(function () {
                                        // Attach click event to the button with id "viewbtn" inside the element with id "showtable"
                                        $("#showtable3").on("click", "#viewbtn3", function () {
                                            // Get the order ID from the data-orderid attribute of the clicked button
                                            var id = $(this).data('orderid');

                                            // Make an AJAX request to the server to fetch the details for the given order ID
                                            $.ajax({
                                                url: "@Url.Action("Details", "Order")",
                                                data: { id: id },
                                                type: 'GET',
                                                success: function (data) {
                                                    // Replace the content of the modal with the received data
                                                    $("#showmodal3 .modal-dialog").html(data);
                                                },
                                                error: function (error) {
                                                    // Log any errors to the console
                                                    console.error("Error fetching details:", error);
                                                }
                                            });
                                        });
                                    });
                                </script>
                            </div>
                            <div id="menu4" class="tab-pane fade @(4 == ViewBag.PageId ? "active show" : "")">
                                <table id="showtable4" class="table">
                                    <thead class="table__thead">
                                        <tr>
                                            <th class="table__th">Email</th>
                                            <th class="table__th">Ngày tạo</th>
                                            <th class="table__th">Địa chỉ</th>
                                            <th class="table__th">SĐT</th>
                                            <th class="table__th">Ghi chú</th>
                                            <th class="table__th">Thanh toán</th>
                                            <th class="table__th">Trạng thái</th>
                                            <th class="table__th"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var items in ds4)
                                        {
                                            <tr class="table-row table-row--chris">
                                                <td class="table-row__td">
                                                    <p>@items.UserName</p>
                                                </td>
                                                <td class="table-row__td">
                                                    <p>@items.NgayTao</p>
                                                </td>
                                                <td class="table-row__td">
                                                    <p>@items.DiaChi</p>
                                                </td>
                                                <td class="table-row__td">
                                                    <p>@items.SĐT</p>
                                                </td>
                                                <td class="table-row__td">
                                                    <p>@items.Note</p>
                                                </td>
                                                <td class="table-row__td">
                                                    @if (items.ThanhToan == 0)
                                                    {
                                                        <p>Thanh toán khi nhận hàng</p>
                                                    }
                                                    @if (items.ThanhToan == 1)
                                                    {
                                                        <p>Thanh toán qua paypal</p>
                                                    }
                                                </td>
                                                <td class="table-row__td">
                                                    @if (items.TrangThai == 4)
                                                    {
                                                        <p>Đã hủy</p>
                                                    }
                                                </td>
                                                <td class="table-row__td">
                                                    <div class="input-form">
                                                        <a class="btn btn-info" data-toggle="modal" id="viewbtn4" data-target="#showmodal4" data-orderid="@items.MaHD">Chi tiết</a>
                                                    </div>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                                <div class="col-sm-12 col-md-7">
                                    <p>Danh sách từ @ViewBag.PageStartItem4 đến @ViewBag.PageEndItem4 trên tổng số @ViewBag.TotalItemCount4 hóa đơn đã hủy</p>
                                    <div class="dataTables_paginate paging_simple_numbers" id="example1_paginate">
                                        <ul class="pagination">
                                            @if (ds4.HasPreviousPage)
                                            {
                                                <li class="page-item">
                                                    <a class="page-link" href="@Url.Action("Index", "Order", new { page4 = ds4.PageNumber - 1, pageId = 4 })"><i class="fa fa-angle-left"></i></a>
                                                </li>

                                            }

                                            <li class="page-item @(1 == ViewBag.Page4 ? "active" : "")">
                                                <a class="page-link" href="@Url.Action("Index", "Order", new { page4 = 1, pageId = 4 })">1</a>
                                            </li>

                                            @if (ds4.PageNumber > 3)
                                            {
                                                <li class="page-item">
                                                    <span class="page-link">...</span>
                                                </li>
                                            }

                                            @for (int i = ds4.PageNumber - 1; i <= ds4.PageNumber + 1; i++)
                                            {
                                                if (i > 1 && i < ds4.PageCount)
                                                {
                                                    <li class="page-item @(i == ds4.PageNumber ? "active" : "")">
                                                        <a class="page-link" href="@Url.Action("Index", "Order", new { page4 = i, pageId = 4 })">@i</a>
                                                    </li>
                                                }
                                            }

                                            @if (ds4.PageNumber < ds4.PageCount - 2)
                                            {
                                                <li class="page-item">
                                                    <span class="page-link">...</span>
                                                </li>
                                            }

                                            @if (ds4.PageCount > 1)
                                            {
                                                <li class="page-item @(ds4.PageCount == ViewBag.Page4 ? "active" : "") ">
                                                    <a class="page-link" href="@Url.Action("Index", "Order", new { page4 = ds4.PageCount, pageId = 4 })">@ds4.PageCount</a>
                                                </li>
                                            }

                                            @if (ds4.HasNextPage)
                                            {

                                                <li class="page-item">
                                                    <a class="page-link" href="@Url.Action("Index", "Order", new { page4 = ds4.PageNumber + 1, pageId = 4 })"><i class="fa fa-angle-right"></i></a>
                                                </li>
                                            }
                                        </ul>
                                    </div>
                                </div>
                                <div class="modal fade" id="showmodal4" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered modal-xl" role="document" style="max-width: 700px;">
                                        <!-- Content will be loaded here dynamically -->
                                    </div>
                                </div>
                                <script>
                                    // Wait for the document to be ready
                                    $(document).ready(function () {
                                        // Attach click event to the button with id "viewbtn" inside the element with id "showtable"
                                        $("#showtable4").on("click", "#viewbtn4", function () {
                                            // Get the order ID from the data-orderid attribute of the clicked button
                                            var id = $(this).data('orderid');

                                            // Make an AJAX request to the server to fetch the details for the given order ID
                                            $.ajax({
                                                url: "@Url.Action("Details", "Order")",
                                                data: { id: id },
                                                type: 'GET',
                                                success: function (data) {
                                                    // Replace the content of the modal with the received data
                                                    $("#showmodal4 .modal-dialog").html(data);
                                                },
                                                error: function (error) {
                                                    // Log any errors to the console
                                                    console.error("Error fetching details:", error);
                                                }
                                            });
                                        });
                                    });
                                </script>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /.container-fluid -->
        </div>
        <!-- /.content -->
    </div>


    <!-- Open modal create -->
    <script>
        jQuery(document).ready(function ($) {
            // Function to set the active tab
            function setActiveTab(tabId) {
                $("ul.nav-tabs li").removeClass("active");
                $("ul.nav-tabs li a[data-toggle='tab'][href='" + tabId + "']").parent().addClass("active");

                // Get the index of the selected tab and set it to 'a'
                var tabIndex = $("ul.nav-tabs li a[data-toggle='tab']").index($("ul.nav-tabs li a[data-toggle='tab'][href='" + tabId + "']"));
                window.a = tabIndex + 1;
                console.log(a);

                // Update the value of the hidden input
                $("#pageId").val(window.a);
            }

            // Handle tab click
            $('ul.nav-tabs li a[data-toggle="tab"]').on('click', function (e) {
                var tabId = $(this).attr("href");
                setActiveTab(tabId);
            });
        });
    </script>

    <!-- Chuyển đổi ngày -->
    <script>
        document.getElementById("formSearch").addEventListener("submit", function (event) {
            var beginDateInput = document.getElementById("beginDate");
            var endDateInput = document.getElementById("endDate");

            var beginDateValue = new Date(beginDateInput.value);
            var endDateValue = new Date(endDateInput.value);

            // Chuyển đổi giá trị thành chuỗi yyyy-MM-dd
            var formattedBeginDate = beginDateValue.toISOString().split("T")[0];
            var formattedEndDate = endDateValue.toISOString().split("T")[0];

            // Gán giá trị mới vào input
            beginDateInput.value = formattedBeginDate;
            endDateInput.value = formattedEndDate;
        });
    </script>
}
else
{
    {
        Layout = null;
    }

    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Access Denied</title>
        <script>
            function goBack() {
                var url = '/Home/Index';
                window.location.href = url;
            }
        </script>
    </head>
    <body>
        <div style="text-align: center; padding: 50px;">
            <h1>Access Denied</h1>
            <p>You do not have permission to access this page.</p>
            <button onclick="goBack()">Go Home</button>
        </div>
    </body>
    </html>
}

